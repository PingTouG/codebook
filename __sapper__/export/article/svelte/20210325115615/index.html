<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=assets/styles/global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,{},{page:{title:"Svelte中的状态管理",slug:"svelte",time:"2021-03-25T11:56:56.000Z",author:"PingTouG",html:"\u003Cp\u003E状态管理一般用于全局共用的一些数据的管理。关于状态管理，在其他的框架中都默认没有提供，都是通过新的库来支持的。比如\u003Ccode\u003EVuex\u003C\u002Fcode\u003E和\u003Ccode\u003ERedux\u003C\u002Fcode\u003E。但在\u003Ccode\u003ESvelte\u003C\u002Fcode\u003E中内置了状态管理，而且用法非常简单。在\u003Ccode\u003ESvelte\u003C\u002Fcode\u003E中关于状态管理的函数都封装在\u003Ccode\u003Esvelte\u002Fstore\u003C\u002Fcode\u003E模块中，此模块可以导出\u003Ccode\u003Ereadable\u003C\u002Fcode\u003E，\u003Ccode\u003Ewritable\u003C\u002Fcode\u003E，\u003Ccode\u003Ederived\u003C\u002Fcode\u003E的功能。\u003C\u002Fp\u003E\n\u003Ch2 id=\"readable\"\u003Ereadable\u003C\u002Fh2\u003E\n\u003Cp\u003E通过\u003Ccode\u003Ereadable\u003C\u002Fcode\u003E创建的状态(数据)，在外部不能直接修改，只能在其内部更改。第一个参数是初始值，可为\u003Ccode\u003Enull\u003C\u002Fcode\u003E，\u003Ccode\u003Eundefined\u003C\u002Fcode\u003E。第二个参数是一个函数，函数接受一个\u003Ccode\u003Eset\u003C\u002Fcode\u003E参数(\u003Ccode\u003Eset\u003C\u002Fcode\u003E是一个函数用于处理内部数据)，如果返回一个函数，则在取消订阅时会被调用。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Frepl\u002F3794dc99ba404971bab2c9426b6c3d96?version=3.35.0\"\u003E在线 REPL\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-svelte\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { readable } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&#x27;svelte\u002Fstore&#x27;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E double = \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003Eval\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E val * \u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E count = readable(\u003Cspan class=\"hljs-literal\"\u003Enull\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003Eset\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E {\n        \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E i = \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E\n        set(i)\n        \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E interval = \u003Cspan class=\"hljs-built_in\"\u003EsetInterval\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-function\"\u003E() =&gt;\u003C\u002Fspan\u003E set(++i), \u003Cspan class=\"hljs-number\"\u003E1000\u003C\u002Fspan\u003E)\n        \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E() =&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003EclearInterval\u003C\u002Fspan\u003E(interval)\n    })\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{double($count)}\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E\u003Ccode\u003E$count\u003C\u002Fcode\u003E是一个语法糖，后续会说明\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch2 id=\"writable\"\u003Ewritable\u003C\u002Fh2\u003E\n\u003Cp\u003E通过\u003Ccode\u003Ewritable\u003C\u002Fcode\u003E创建的状态(数据)，在外部可以通过\u003Ccode\u003Eupdate\u003C\u002Fcode\u003E更新，\u003Ccode\u003Eset\u003C\u002Fcode\u003E设置值，\u003Ccode\u003Esubscribe\u003C\u002Fcode\u003E订阅状态的改变(\u003Ccode\u003Esubscribe\u003C\u002Fcode\u003E返回一个函数用于取消订阅)。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Frepl\u002F9d611111b7ff43e4a4dd575c3b53e292?version=3\"\u003E在线 REPL\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-svelte\"\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{ onDestroy }\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"javascript\"\u003E \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&#x27;svelte&#x27;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{ writable }\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"javascript\"\u003E \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&#x27;svelte\u002Fstore&#x27;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E count = writable(\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E countValue = \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E unSubscribe = count.subscribe(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003Eval\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E countValue = val)\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E onSub = \u003Cspan class=\"hljs-function\"\u003E() =&gt;\u003C\u002Fspan\u003E count.update(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003En\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E n - \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E onAdd = \u003Cspan class=\"hljs-function\"\u003E() =&gt;\u003C\u002Fspan\u003E count.update(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003En\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E n + \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E onReset = \u003Cspan class=\"hljs-function\"\u003E() =&gt;\u003C\u002Fspan\u003E count.set(\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E)\n\n    onDestroy(unSubscribe)\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EcountValue：\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{countValue}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eon:click\u003C\u002Fspan\u003E=\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{onSub}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&gt;\u003C\u002Fspan\u003E-\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eon:click\u003C\u002Fspan\u003E=\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{onAdd}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&gt;\u003C\u002Fspan\u003E+\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eon:click\u003C\u002Fspan\u003E=\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{onReset}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&gt;\u003C\u002Fspan\u003Ereset\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E上面的例子中，可以通过\u003Ccode\u003E$count\u003C\u002Fcode\u003E进行精简代码，当使用\u003Ccode\u003E$count\u003C\u002Fcode\u003E时可以自动订阅状态变化以及在组件销毁时取消状态的订阅，而且\u003Ccode\u003E$count\u003C\u002Fcode\u003E是响应式的，即：\u003Ccode\u003Ecount.update(val =&gt; val + 1)\u003C\u002Fcode\u003E可以写成\u003Ccode\u003E$count += 1\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Frepl\u002F0a0925f64695407da6ba923ce29f3689?version=3\"\u003E在线 REPL\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-svelte\"\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{ writable }\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"javascript\"\u003E \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&#x27;svelte\u002Fstore&#x27;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E count = writable(\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E)\n\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E onSub = \u003Cspan class=\"hljs-function\"\u003E() =&gt;\u003C\u002Fspan\u003E count.update(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003En\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E n - \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E onAdd = \u003Cspan class=\"hljs-function\"\u003E() =&gt;\u003C\u002Fspan\u003E count.update(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003En\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E n + \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E onReset = \u003Cspan class=\"hljs-function\"\u003E() =&gt;\u003C\u002Fspan\u003E count.set(\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E)\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Ecount：\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{$count}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eon:click\u003C\u002Fspan\u003E=\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{onSub}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&gt;\u003C\u002Fspan\u003E-\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eon:click\u003C\u002Fspan\u003E=\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{onAdd}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&gt;\u003C\u002Fspan\u003E+\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eon:click\u003C\u002Fspan\u003E=\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{onReset}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&gt;\u003C\u002Fspan\u003Ereset\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"derived\"\u003Ederived\u003C\u002Fh2\u003E\n\u003Cp\u003E通过\u003Ccode\u003Ederived\u003C\u002Fcode\u003E可以通过状态来派生出来另一个状态，当依赖的状态发生变化时则立即调用其回调。回调函数接受三个参数：第一个参数是依赖的状态。第二个参数是回调函数，回调函数第一个参数是是依赖的状态变化之后的值，第二个参数是\u003Ccode\u003Eset\u003C\u002Fcode\u003E函数用于设置新的派生状态，此函数中可以进行异步操作。第三个参数是一个默认值，当回调函数是一个异步函数时，此值才有效。\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E此外，如果不使用\u003Ccode\u003Eset\u003C\u002Fcode\u003E函数，可以直接返回一个值作为派生状态。但是如果有\u003Ccode\u003Eset\u003C\u002Fcode\u003E函数，则需要用\u003Ccode\u003Eset\u003C\u002Fcode\u003E函数来设置。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Frepl\u002Fbebb3bdfc945401a99e21d9865a07c10?version=3.35.0\"\u003E在线 REPL\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-svelte\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { writable, derived } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&#x27;svelte\u002Fstore&#x27;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E count = writable(\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E doubleCount = derived(count, $val =&gt; $val * \u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E doubleSetCount = derived(count, \u003Cspan class=\"hljs-function\"\u003E(\u003Cspan class=\"hljs-params\"\u003E$val, set\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E set($val * \u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E))\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E asyncDoubleCount = derived(count, \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E ($val, set) =&gt; {\n        \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E data = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003EPromise\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003Eresolve\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E {\n            \u003Cspan class=\"hljs-built_in\"\u003EsetTimeout\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-function\"\u003E()=&gt;\u003C\u002Fspan\u003E {\n                resolve($val * \u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E)\n            }, \u003Cspan class=\"hljs-number\"\u003E1000\u003C\u002Fspan\u003E)\n        })\n\n        set(data)\n    },\u003Cspan class=\"hljs-string\"\u003E&#x27;loading&#x27;\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E onAdd = \u003Cspan class=\"hljs-function\"\u003E() =&gt;\u003C\u002Fspan\u003E $count++\n\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E time = writable(\u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003EDate\u003C\u002Fspan\u003E())\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E timer = derived(time, \u003Cspan class=\"hljs-function\"\u003E(\u003Cspan class=\"hljs-params\"\u003E$time, set\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E {\n        \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E interval = \u003Cspan class=\"hljs-built_in\"\u003EsetInterval\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-function\"\u003E() =&gt;\u003C\u002Fspan\u003E set(\u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003EDate\u003C\u002Fspan\u003E()) , \u003Cspan class=\"hljs-number\"\u003E1000\u003C\u002Fspan\u003E)\n\n        \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E() =&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003EclearInterval\u003C\u002Fspan\u003E(interval)\n    })\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Ecount: {$count}\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EdoubleCount: {$doubleCount}\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EdoubleSetCount: {$doubleSetCount}\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EasyncDoubleCount: {$asyncDoubleCount}\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eon:click\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E{onAdd}\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E+1\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Etimer: {$timer}\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"get\"\u003Eget\u003C\u002Fh2\u003E\n\u003Cp\u003E如果你仅仅是想获取状态值，可以通过\u003Ccode\u003Eget\u003C\u002Fcode\u003E来获取，这个函数只是获取当前状态的值。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Frepl\u002Fcb81b07703f04862bc83e6d663c08818?version=3\"\u003E在线 REPL\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-svelte\"\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{ writable, get }\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"javascript\"\u003E \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&#x27;svelte\u002Fstore&#x27;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E count = writable(\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.log(get(count))\n\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E onAdd = \u003Cspan class=\"hljs-function\"\u003E() =&gt;\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{\n        $count++\n        console.log(get(count))\n    }\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Ecount: \u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{$count}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eon:click\u003C\u002Fspan\u003E=\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{onAdd}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&gt;\u003C\u002Fspan\u003E+1\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"自定义-store\"\u003E自定义 store\u003C\u002Fh2\u003E\n\u003Cp\u003E只要一个对象实现了\u003Ccode\u003Esubscribe\u003C\u002Fcode\u003E方法，那么就是一个\u003Ccode\u003Estore\u003C\u002Fcode\u003E。我们可以通过\u003Ccode\u003Esvelte\u002Fstore\u003C\u002Fcode\u003E提供的模块来对状态进行封装。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Frepl\u002Fb28f84feec324dbc93d1283702b43d24?version=3\"\u003E在线 REPL\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ccode\u003EcountStore.js\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { writable } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&#x27;svelte\u002Fstore&#x27;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E const useCount = \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E {\n  const { subscribe, set, update } = writable(\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E)\n\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E {\n    subscribe,\n    sub: \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E update(val =&gt; val - \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E),\n    add: \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E update(val =&gt; val + \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E),\n    reset: \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E set(\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E),\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Ccode\u003EApp.svelte\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-svelte\"\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{ useCount }\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"javascript\"\u003E \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&#x27;.\u002FcountStore&#x27;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E count = useCount()\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003Ecount：\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{$count}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eon:click\u003C\u002Fspan\u003E=\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{count.sub}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&gt;\u003C\u002Fspan\u003E-\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eon:click\u003C\u002Fspan\u003E=\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{count.add}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&gt;\u003C\u002Fspan\u003E+\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eon:click\u003C\u002Fspan\u003E=\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-template-variable\"\u003E{count.reset}\u003C\u002Fspan\u003E\u003Cspan class=\"xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&gt;\u003C\u002Fspan\u003Ereset\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ebutton\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');var s=document.createElement("script");try{new Function("if(0)import('')")();s.src="/client/client.ac5247b3.js";s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.5.js";s.setAttribute("data-main","/client/client.ac5247b3.js")}document.head.appendChild(s)</script> <link href=client/client-5905f011.css rel=stylesheet><link href=client/_layout-8d114d53.css rel=stylesheet><link href=client/[...slug]-bb07c72b.css rel=stylesheet> <title>Svelte中的状态管理</title> <link href=/client/client.ac5247b3.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-5905f011.css rel=preload as=style><link href=/client/[...slug].9491a532.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/utils.302b01ae.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/[...slug]-bb07c72b.css rel=preload as=style></head> <body> <div id=sapper> <section class=svelte-r1sizb><header class=svelte-r1sizb><a href=./ ><img alt="code book logo" class="svelte-r1sizb logo" src=/assets/images/logo.png></a> <a href=https://github.com/PingTouG class="svelte-r1sizb github" target=_blank><i class="svelte-r1sizb icon-github iconfont"></i></a></header> <main><section><main class=svelte-he2wxq> <section class=md><h1 class=title>Svelte中的状态管理</h1> <div class="svelte-4z8ncs info"><div class="svelte-4z8ncs author">作者：PingTouG</div> <div class=time>时间：2021-03-25 11:56:56</div></div> <div class=md-content><p>状态管理一般用于全局共用的一些数据的管理。关于状态管理，在其他的框架中都默认没有提供，都是通过新的库来支持的。比如<code>Vuex</code>和<code>Redux</code>。但在<code>Svelte</code>中内置了状态管理，而且用法非常简单。在<code>Svelte</code>中关于状态管理的函数都封装在<code>svelte/store</code>模块中，此模块可以导出<code>readable</code>，<code>writable</code>，<code>derived</code>的功能。</p> <h2 id=readable>readable</h2> <p>通过<code>readable</code>创建的状态(数据)，在外部不能直接修改，只能在其内部更改。第一个参数是初始值，可为<code>null</code>，<code>undefined</code>。第二个参数是一个函数，函数接受一个<code>set</code>参数(<code>set</code>是一个函数用于处理内部数据)，如果返回一个函数，则在取消订阅时会被调用。</p> <p><a href="https://svelte.dev/repl/3794dc99ba404971bab2c9426b6c3d96?version=3.35.0">在线 REPL</a></p> <pre><code class=language-svelte><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
    <span class=hljs-keyword>import</span> { readable } <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte/store'</span>

    <span class=hljs-keyword>const</span> double = <span class=hljs-function><span class=hljs-params>val</span> =></span> val * <span class=hljs-number>2</span>
    <span class=hljs-keyword>let</span> count = readable(<span class=hljs-literal>null</span>, <span class=hljs-function><span class=hljs-params>set</span> =></span> {
        <span class=hljs-keyword>let</span> i = <span class=hljs-number>1</span>
        set(i)
        <span class=hljs-keyword>const</span> interval = <span class=hljs-built_in>setInterval</span>(<span class=hljs-function>() =></span> set(++i), <span class=hljs-number>1000</span>)
        <span class=hljs-keyword>return</span> <span class=hljs-function>() =></span> <span class=hljs-built_in>clearInterval</span>(interval)
    })
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>{double($count)}<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>
</code></pre> <blockquote> <p><code>$count</code>是一个语法糖，后续会说明</p> </blockquote> <h2 id=writable>writable</h2> <p>通过<code>writable</code>创建的状态(数据)，在外部可以通过<code>update</code>更新，<code>set</code>设置值，<code>subscribe</code>订阅状态的改变(<code>subscribe</code>返回一个函数用于取消订阅)。</p> <p><a href="https://svelte.dev/repl/9d611111b7ff43e4a4dd575c3b53e292?version=3">在线 REPL</a></p> <pre><code class=language-svelte><span class=xml><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
    <span class=hljs-keyword>import</span> </span></span><span class=hljs-template-variable>{ onDestroy }</span><span class=xml><span class=javascript> <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte'</span>
    <span class=hljs-keyword>import</span> </span></span><span class=hljs-template-variable>{ writable }</span><span class=xml><span class=javascript> <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte/store'</span>

    <span class=hljs-keyword>let</span> count = writable(<span class=hljs-number>0</span>)
    <span class=hljs-keyword>let</span> countValue = <span class=hljs-number>0</span>

    <span class=hljs-keyword>const</span> unSubscribe = count.subscribe(<span class=hljs-function><span class=hljs-params>val</span> =></span> countValue = val)
    <span class=hljs-keyword>const</span> onSub = <span class=hljs-function>() =></span> count.update(<span class=hljs-function><span class=hljs-params>n</span> =></span> n - <span class=hljs-number>1</span>)
    <span class=hljs-keyword>const</span> onAdd = <span class=hljs-function>() =></span> count.update(<span class=hljs-function><span class=hljs-params>n</span> =></span> n + <span class=hljs-number>1</span>)
    <span class=hljs-keyword>const</span> onReset = <span class=hljs-function>() =></span> count.set(<span class=hljs-number>0</span>)

    onDestroy(unSubscribe)
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>countValue：</span><span class=hljs-template-variable>{countValue}</span><span class=xml><span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>button</span> <span class=hljs-attr>on:click</span>=</span></span><span class=hljs-template-variable>{onSub}</span><span class=xml><span class=hljs-tag>></span>-<span class=hljs-tag>&lt;/<span class=hljs-name>button</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>button</span> <span class=hljs-attr>on:click</span>=</span></span><span class=hljs-template-variable>{onAdd}</span><span class=xml><span class=hljs-tag>></span>+<span class=hljs-tag>&lt;/<span class=hljs-name>button</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>button</span> <span class=hljs-attr>on:click</span>=</span></span><span class=hljs-template-variable>{onReset}</span><span class=xml><span class=hljs-tag>></span>reset<span class=hljs-tag>&lt;/<span class=hljs-name>button</span>></span></span>
</code></pre> <p>上面的例子中，可以通过<code>$count</code>进行精简代码，当使用<code>$count</code>时可以自动订阅状态变化以及在组件销毁时取消状态的订阅，而且<code>$count</code>是响应式的，即：<code>count.update(val => val + 1)</code>可以写成<code>$count += 1</code>。</p> <p><a href="https://svelte.dev/repl/0a0925f64695407da6ba923ce29f3689?version=3">在线 REPL</a></p> <pre><code class=language-svelte><span class=xml><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
    <span class=hljs-keyword>import</span> </span></span><span class=hljs-template-variable>{ writable }</span><span class=xml><span class=javascript> <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte/store'</span>

    <span class=hljs-keyword>let</span> count = writable(<span class=hljs-number>0</span>)

    <span class=hljs-keyword>const</span> onSub = <span class=hljs-function>() =></span> count.update(<span class=hljs-function><span class=hljs-params>n</span> =></span> n - <span class=hljs-number>1</span>)
    <span class=hljs-keyword>const</span> onAdd = <span class=hljs-function>() =></span> count.update(<span class=hljs-function><span class=hljs-params>n</span> =></span> n + <span class=hljs-number>1</span>)
    <span class=hljs-keyword>const</span> onReset = <span class=hljs-function>() =></span> count.set(<span class=hljs-number>0</span>)
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>count：</span><span class=hljs-template-variable>{$count}</span><span class=xml><span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>button</span> <span class=hljs-attr>on:click</span>=</span></span><span class=hljs-template-variable>{onSub}</span><span class=xml><span class=hljs-tag>></span>-<span class=hljs-tag>&lt;/<span class=hljs-name>button</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>button</span> <span class=hljs-attr>on:click</span>=</span></span><span class=hljs-template-variable>{onAdd}</span><span class=xml><span class=hljs-tag>></span>+<span class=hljs-tag>&lt;/<span class=hljs-name>button</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>button</span> <span class=hljs-attr>on:click</span>=</span></span><span class=hljs-template-variable>{onReset}</span><span class=xml><span class=hljs-tag>></span>reset<span class=hljs-tag>&lt;/<span class=hljs-name>button</span>></span></span>
</code></pre> <h2 id=derived>derived</h2> <p>通过<code>derived</code>可以通过状态来派生出来另一个状态，当依赖的状态发生变化时则立即调用其回调。回调函数接受三个参数：第一个参数是依赖的状态。第二个参数是回调函数，回调函数第一个参数是是依赖的状态变化之后的值，第二个参数是<code>set</code>函数用于设置新的派生状态，此函数中可以进行异步操作。第三个参数是一个默认值，当回调函数是一个异步函数时，此值才有效。</p> <blockquote> <p>此外，如果不使用<code>set</code>函数，可以直接返回一个值作为派生状态。但是如果有<code>set</code>函数，则需要用<code>set</code>函数来设置。</p> </blockquote> <p><a href="https://svelte.dev/repl/bebb3bdfc945401a99e21d9865a07c10?version=3.35.0">在线 REPL</a></p> <pre><code class=language-svelte><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
    <span class=hljs-keyword>import</span> { writable, derived } <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte/store'</span>

    <span class=hljs-keyword>let</span> count = writable(<span class=hljs-number>0</span>)
    <span class=hljs-keyword>let</span> doubleCount = derived(count, $val => $val * <span class=hljs-number>2</span>)
    <span class=hljs-keyword>let</span> doubleSetCount = derived(count, <span class=hljs-function>(<span class=hljs-params>$val, set</span>) =></span> set($val * <span class=hljs-number>2</span>))
    <span class=hljs-keyword>let</span> asyncDoubleCount = derived(count, <span class=hljs-keyword>async</span> ($val, set) => {
        <span class=hljs-keyword>const</span> data = <span class=hljs-keyword>await</span> <span class=hljs-keyword>new</span> <span class=hljs-built_in>Promise</span>(<span class=hljs-function><span class=hljs-params>resolve</span> =></span> {
            <span class=hljs-built_in>setTimeout</span>(<span class=hljs-function>()=></span> {
                resolve($val * <span class=hljs-number>4</span>)
            }, <span class=hljs-number>1000</span>)
        })

        set(data)
    },<span class=hljs-string>'loading'</span>)
    <span class=hljs-keyword>const</span> onAdd = <span class=hljs-function>() =></span> $count++

    <span class=hljs-keyword>let</span> time = writable(<span class=hljs-keyword>new</span> <span class=hljs-built_in>Date</span>())
    <span class=hljs-keyword>let</span> timer = derived(time, <span class=hljs-function>(<span class=hljs-params>$time, set</span>) =></span> {
        <span class=hljs-keyword>const</span> interval = <span class=hljs-built_in>setInterval</span>(<span class=hljs-function>() =></span> set(<span class=hljs-keyword>new</span> <span class=hljs-built_in>Date</span>()) , <span class=hljs-number>1000</span>)

        <span class=hljs-keyword>return</span> <span class=hljs-function>() =></span> <span class=hljs-built_in>clearInterval</span>(interval)
    })
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>count: {$count}<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>doubleCount: {$doubleCount}<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>doubleSetCount: {$doubleSetCount}<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>asyncDoubleCount: {$asyncDoubleCount}<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>button</span> <span class=hljs-attr>on:click</span>=<span class=hljs-string>{onAdd}</span>></span>+1<span class=hljs-tag>&lt;/<span class=hljs-name>button</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>timer: {$timer}<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>
</code></pre> <h2 id=get>get</h2> <p>如果你仅仅是想获取状态值，可以通过<code>get</code>来获取，这个函数只是获取当前状态的值。</p> <p><a href="https://svelte.dev/repl/cb81b07703f04862bc83e6d663c08818?version=3">在线 REPL</a></p> <pre><code class=language-svelte><span class=xml><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
    <span class=hljs-keyword>import</span> </span></span><span class=hljs-template-variable>{ writable, get }</span><span class=xml><span class=javascript> <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte/store'</span>

    <span class=hljs-keyword>let</span> count = writable(<span class=hljs-number>0</span>)
    <span class=hljs-built_in>console</span>.log(get(count))

    <span class=hljs-keyword>const</span> onAdd = <span class=hljs-function>() =></span> </span></span><span class=hljs-template-variable>{
        $count++
        console.log(get(count))
    }</span><span class=xml>
<span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>count: </span><span class=hljs-template-variable>{$count}</span><span class=xml><span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>button</span> <span class=hljs-attr>on:click</span>=</span></span><span class=hljs-template-variable>{onAdd}</span><span class=xml><span class=hljs-tag>></span>+1<span class=hljs-tag>&lt;/<span class=hljs-name>button</span>></span></span>
</code></pre> <h2 id=自定义-store>自定义 store</h2> <p>只要一个对象实现了<code>subscribe</code>方法，那么就是一个<code>store</code>。我们可以通过<code>svelte/store</code>提供的模块来对状态进行封装。</p> <p><a href="https://svelte.dev/repl/b28f84feec324dbc93d1283702b43d24?version=3">在线 REPL</a></p> <p><code>countStore.js</code></p> <pre><code class=language-javascript><span class=hljs-keyword>import</span> { writable } <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte/store'</span>
<span class=hljs-keyword>export</span> const useCount = <span class=hljs-function><span class=hljs-params>()</span> =></span> {
  const { subscribe, set, update } = writable(<span class=hljs-number>0</span>)

  <span class=hljs-keyword>return</span> {
    subscribe,
    sub: <span class=hljs-function><span class=hljs-params>()</span> =></span> update(val => val - <span class=hljs-number>1</span>),
    add: <span class=hljs-function><span class=hljs-params>()</span> =></span> update(val => val + <span class=hljs-number>1</span>),
    reset: <span class=hljs-function><span class=hljs-params>()</span> =></span> set(<span class=hljs-number>0</span>),
  }
}
</code></pre> <p><code>App.svelte</code></p> <pre><code class=language-svelte><span class=xml><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
    <span class=hljs-keyword>import</span> </span></span><span class=hljs-template-variable>{ useCount }</span><span class=xml><span class=javascript> <span class=hljs-keyword>from</span> <span class=hljs-string>'./countStore'</span>
    <span class=hljs-keyword>const</span> count = useCount()
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>count：</span><span class=hljs-template-variable>{$count}</span><span class=xml><span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>button</span> <span class=hljs-attr>on:click</span>=</span></span><span class=hljs-template-variable>{count.sub}</span><span class=xml><span class=hljs-tag>></span>-<span class=hljs-tag>&lt;/<span class=hljs-name>button</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>button</span> <span class=hljs-attr>on:click</span>=</span></span><span class=hljs-template-variable>{count.add}</span><span class=xml><span class=hljs-tag>></span>+<span class=hljs-tag>&lt;/<span class=hljs-name>button</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>button</span> <span class=hljs-attr>on:click</span>=</span></span><span class=hljs-template-variable>{count.reset}</span><span class=xml><span class=hljs-tag>></span>reset<span class=hljs-tag>&lt;/<span class=hljs-name>button</span>></span></span>
</code></pre> </div> </section></main> </section></main> <div class="back-top svelte-1m03zpm" style=bottom:5rem;right:.625rem;display:none><i class="iconfont icon-back-top"></i> </div> </section></div> 